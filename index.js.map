{"version":3,"file":"index.js","sources":["src/make-filter.js","src/parse-options.js","src/proc-file.js","src/index.js"],"sourcesContent":["import { createFilter } from 'rollup-pluginutils'\nimport { extname } from 'path'\n\n/**\n * Creates a filter for the options `include`, `exclude`, and `extensions`.\n *\n * Since `extensions` is not a rollup option, I think is widely used.\n *\n * @param {import('..').Options} opts The user options\n * @param {array|string} exts Default extensions\n * @returns {function} Filter function that returns true if a given file\n *    matches the filter.\n */\nconst makeFilter = function makeFilter (opts, exts) {\n\n  const _filt = createFilter(opts.include, opts.exclude)\n\n  exts = opts.extensions || exts\n  if (!exts || exts === '*') {\n    return _filt   // do not filter extensions\n  }\n\n  if (!Array.isArray(exts)) {\n    exts = [exts]\n  }\n  exts = exts.map((e) => (e[0] !== '.' ? `.${e}` : e))\n\n  return (id) => _filt(id) && exts.indexOf(extname(id)) > -1\n}\n\nexport default makeFilter\n","import getPackageVersion from '@jsbits/get-package-version'\n\n/**\n * @param {import('..').Options} options -\n * @returns {import('jscc').Options}\n */\nconst parseOptions = (options) => {\n\n  options = Object.assign({\n    prefixes: [/\\/[/*] ?/, /<!-- ?/],\n  }, options)\n\n  options.values = Object.assign({\n    _VERSION: getPackageVersion(),\n  }, options.values)\n\n  options.sourceMap = options.sourcemap !== false && options.sourceMap !== false\n\n  return options\n}\n\nexport default parseOptions\n","import fs from 'fs'\nimport jscc from 'jscc'\n\n/**\n * Returns a shallow copy of the jscc options.\n *\n * @param {jscc.Options} opts\n * @returns {jscc.Options}\n */\nconst _getJsccOpts = (opts) => ({\n  escapeQuotes: opts.escapeQuotes,\n  keepLines: opts.keepLines,\n  mapHires: opts.mapHires,\n  prefixes: opts.prefixes,\n  sourceMap: opts.sourceMap,\n  mapContent: opts.mapContent,\n  values: Object.assign({}, opts.values),\n})\n\n/**\n * Simple wrapper for the async `fs.readFile` that returns a Promise that\n * resolves to a string with the content decoded as utf8.\n *\n * @param {string} fname Absolute or relative to cwd\n * @returns {Promise<string>}\n */\nconst _getSource = (fname) => new Promise((resolve, reject) => {\n  fs.readFile(fname, 'utf8', (error, data) => {\n    // istanbul ignore if\n    if (error) {\n      reject(error)\n    } else {\n      resolve(data)\n    }\n  })\n})\n\n/**\n * Call jscc and returns a Promise that is resolved with a {code,map} object\n * or a string if the buffer did not change or `options.sourceMap:false`.\n *\n * @param {string} fname Absolute or relative to cwd\n * @param {jscc.Options} options jscc options\n * @param {string} [code] Source\n * @returns {Promise<string>}\n */\nconst procFile = function (fname, options, code) {\n  // Supports transform\n  const promise = code != null ? Promise.resolve(code) : _getSource(fname)\n\n  return promise\n    .then((source) => {\n      // Supports buffer\n      if (typeof Buffer !== 'undefined' && Buffer.isBuffer(source)) {\n        source = source.toString()\n      }\n      // Ignore non-string sources\n      return typeof source === 'string'\n        ? jscc(source, fname, _getJsccOpts(options))\n        : source\n    })\n}\n\nexport default procFile\n","import makeFilter from './make-filter'\nimport parseOptions from './parse-options'\nimport procFile from './proc-file'\n\n/**\n * rollup-plugin-jscc entry point\n *\n * @param {import('..').Options} options User options\n * @returns {import('rollup').Plugin}\n */\nconst jsccPlugin = function jsccPlugin (options) {\n\n  // Get the jscc options from the plugin options\n  options = parseOptions(options)\n\n  const filter = makeFilter(options, ['.js', '.jsx', 'ts', 'tsx', '.tag'])\n\n  if (options.asloader !== false) {\n    return {\n      name: 'jscc',\n      load (id) {\n        return filter(id) ? procFile(id, options) : null\n      },\n    }\n  }\n\n  return {\n    name: 'jscc',\n    transform: function (code, id) {\n      return filter(id) ? procFile(id, options, code) : null\n    },\n  }\n}\n\nexport default jsccPlugin\n"],"names":["createFilter","extname"],"mappings":"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"}